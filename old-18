<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 18</title>
<style type="text/css">
body { background:black; color:white; font-size:10pt; }
input { background:silver; }
a { color:lightgreen; }
</style>
</head>
<body>
<br><br>
<center><h1>SQL INJECTION</h1>
<form method=get action=index.php>
<table border=0 align=center cellpadding=10 cellspacing=0>
<tr><td><input type=text name=no></td><td><input type=submit></td></tr>
</table>
</form>
<a style=background:gray;color:black;width:100;font-size:9pt;><b>RESULT</b><br>
<?php
if($_GET['no']){
  $db = dbconnect();
  if(preg_match("/ |\/|\(|\)|\||&|select|from|0x/i",$_GET['no'])) exit("no hack");
  $result = mysqli_fetch_array(mysqli_query($db,"select id from chall18 where id='guest' and no=$_GET[no]")); // admin's no = 2

  if($result['id']=="guest") echo "hi guest";
  if($result['id']=="admin"){
    solve(18);
    echo "hi admin!";
  }
}
?>
</a>
<br><br><a href=?view_source=1>view-source</a>
</center>
</body>
</html>



<?php
if($_GET['no']){         //no 값을 get방식으로 받았을 떄 
  $db = dbconnect();      //db를 연결시켜
  if(preg_match("/ |\/|\(|\)|\||&|select|from|0x/i",$_GET['no'])) exit("no hack");

  //$_GET['no'] 값을 필터링한다. 해당 문자들이 존재하면 'no hack'과 함께 코드종료
  $result = mysqli_fetch_array(mysqli_query($db,"select id from chall18 where id='guest' and no=$_GET[no]")); // admin's no = 2
  //chall18 테이블에서 id가 'guest'이고 no가 입력받은 값인 id를 선택해 배열 추출 후 result에 저장
  if($result['id']=="guest") echo "hi guest"; //id가 'guest'이면 "hi guest" 출력
  if($result['id']=="admin"){ //id가 'admin'이면 
    solve(18);
    echo "hi admin!";  //"hi admin" 문자열과 함께 문제 해결
  }
}
?>

get 방식 : 폼으로 부터 넘어오는 값을 저장하는 방식으로 입력데이터를 url 정보에 붙여서 전송한다. 여러모로 보안이 취약하며 데이터 길이는 256바이트를 넘을 수 없다. 전송속도가 빠르다.
<form method=get action=index.php>  --> 폼이 get 방식이며 폼의 값이 넘어가면 index.php이 실행된다.
preg_match( ) : 패턴과 매치되는 문자열을 찾았을 때 1반환, 찾시 못했을 때는 0반환
mysql_fetch_array( resource $result [, int $result_type] ) : 인출된 행을 배열로 반환하고, 앞으로 내부 데이터 포인터를 이동한다.
mysql_query( string $query [, resource $link_identifier]) : link_identifier로 지정한 데이터베이스 서버에 하나의 쿼리를 전송한다.


출처: https://winkite1226.tistory.com/112 [고양이 퍼레이드]


04-11
